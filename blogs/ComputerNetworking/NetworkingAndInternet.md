

# 计算机网络和因特网

## 因特网

什么是因特网:    
	可以考虑从两个方面回答这个问题:    

1. 能够描述因特网的具体构成,即构成因特网的基本硬件和软件组件
2. 能够根据为分布式应用提供服务的联网基础设施来描述因特网

### 具体构成

所有连接到因特网的设备都可以称为**主机(host)**或者**端系统(end system)**  
端系统通过**通信链路**和**分组交换机**连接到一起

**通信链路**  
不同类型的通信链路,由不同类型的物理媒体组成,包括同轴电缆,铜线,光纤,无线电频谱  
不同的链路(由不同类型的物理媒体组成)能以不同的速率传输数据. 单位是 比特/秒 (bit / s)   

**分组**(packet)  
当一台端系统向另一台端系统发送数据的时候,发送端将数据分段,并为每段加上首部字节, 由此形成的信息包用计算机网络的术语来说称为分组,这些分组将在目的端系统被装配成初始数据    
分组交换机从它的一条入通信链路接受到达的分组,并从它的一条出通信链路转发该分组      
最著名的两种分组交换机:

1. 路由器  通常用于网络核心之中
2. 链路层交换机  通常用于接入网之中

==一个分组所经历的一系列通信链路和分组交换机称为通过该网络的**路径**==

端系统通过**因特网服务提供商(ISP)**接入因特网  每个ISP是一个**由多个分组交换机和多段通信链路组成的网络**

端系统,分组交换机和其他因特网部件都需要运行一系列**协议(protocol)**,这些协议控制因特网中信息的接收和发送.  
TCP(Transmission Control Protocol,控制传输协议)和IP(Internet Protocol,网络协议)是因特网中最重要的两个协议, IP协议定义了在端系统和路由器之间发送和接收的分组格式

### 服务描述

从**为应用程序提供服务的基础设施**的角度来描述因特网  
电子邮箱,即时讯息,社交网络,分布式游戏,p2p. 这些应用程序称为**分布式应用程序**,因为它们涉及多台相互交换数据的端系统,重要的是,因特网应用程序运行在端系统上,即它们并不运行在网络核心的分组交换机中

**运行在一个端系统上的应用程序怎么才能指令因特网向运行在另一个端系统上的软件发送数据呢**  

- 与因特网相连的端系统提供了一个**应用程序编程接口**,该API规定了运行在一个端系统上的软件请求因特网基础设施向在运行在另一个端系统上的特定目的地软件交付数据的方式

### 协议

一个协议定义了在两个或多个通信实体之间交换的报文格式和次序,以及报文发送和/或接收一条报文或其他时间所采取的动作

协议三要素:

1. 语法
2. 语义
3. 同步(时序)

## 网络边缘

### 接入网

接入网(access network),指将端系统连接到其**边缘路由器(edge router)**的物理链路.   
边缘路由器是端系统到任何其他远程端系统的路径上的第一台路由器. 

- 家庭接入
  - DSL, 电缆, FTTH, 拨号和卫星
- 企业接入
  - 以太网和WIFI
- 广域无线接入
  - 3G和LITE

### 物理媒体

物理媒体划分为两类: 

1. 导引型媒体:电波沿着固体媒体前行,如光缆 双绞铜线 同轴电缆
2. 非导引型媒体:电波在空气或外层空间中传播, 例如在无线局域网或数字卫星频道中

1. 双绞铜线
2. 同轴电缆
3. 光纤
4. 陆地无线电信道
5. 卫星无线电信道

## 网络核心

通过网络链路和交换机移动数据有两种基本方法: **电路交换**和**分组交换**

### 分组交换

在各种网络应用中, 端系统彼此交换报文(message)  
为了从源端系统向目的端系统发送一个报文, 源将长报文划分为较小的数据块,称之为**分组(packet)**.在源和目的之间,每个分组都通过通信链路和**分组交换机**传送. 

- 存储转发传输
  - 多数分组交换机在链路的输出端使用**存储转发传输(可能导致网络拥塞,网络延迟)**机制. 
  - 存储转发机制是指在交换机能开始向输出链路传输该分组的第一个比特之前,必须接收到整个分组
- 排队时延和分组丢失
  - 每个分组交换机由多条链路与之相连,对于每条相连的链路,该分组交换机具有一个**输出缓存(输出队列)**, 用于存储路由器准备发往那条链路的分组
  - 因此,除了存储转发时延之外,分组还要承受输出缓存的**排队时延**. 因为缓存空间大小有限,一个到达的分组可能发现该缓存已经被其他等待传输的分组完全充满了,此情况下,将会出现**分组丢包**,到达的分组或已经排队的分组之一将被丢弃
- 转发表和路由选择协议
  - 当源主机向目的端系统发送一个分组时,源在该分组的首部包含了目的地的IP地址. 每台路由器具有一个**转发表**, 用于将目的地址(或者目的地址的一部分)映射成为输出链路

### 电路交换

在电路交换网络中, 在端系统间通信会话期间, 预留了端系统间通信沿路径所需要的资源(缓存,链路和传输速率). 

#### 电路交换网络中的复用

链路中的电路是通过**频分复用(FDM)**或**时分复用(TDM)**来实现的

==**分组交换的性能优于电路交换的性能**==

### 网络的网络

端系统(pc, 智能手机, Web服务器, 电子邮件服务等)经过一个接入ISP与因特网相连. 该接入ISP能提供有线或无线连接,使用了包括DSL, 电缆, FTTH, WIFI等多种接入技术. 因为因特网是由数以亿计的用户构成的,为端用户和内容提供商提供与接入ISP的连接仅解决了连接难题中的很小一部分. 解决这个难题,接入ISP自身必须互联, 通过创建**网络的网络**来实现

#### **网络结构Ⅰ:**  
用单一的**全球承载ISP(提供商)**互联所有**接入ISP(客户)**. 

#### **网络结构Ⅱ:**  
由数十万接入ISP和多个全球承载ISP组成(这些全球ISP必须是互联的)

在任意给定的区域,可能有一个区域ISP,区域中的接入ISP与之连接. 每个区域ISP则与**第一层ISP(类似于假象的全球ISP)**连接,大约有十几个第一层ISP

#### **网络结构Ⅲ:**  
在某些区域中,可能有较大的区域ISP,区域中较小的区域ISP与之相连,较大的和第一层ISP相连. 如 城市ISP与省级ISP相连, 省级ISP与国家级ISP相连, 国家级ISP和第一层ISP相连

- 存在点POP(point of presence), 存在于等级结构的所有层次,底层(接入ISP)除外  
  - 一个pop只是提供商网络中的一台或多台路由器(在相同位置)群组
- 任何ISP(除了第一层ISP)可以选择为**多宿(multi-home)**,即可以与多个或更多提供商ISP连接
- 位于相同等级结构层次的临近一对ISP能够**对等**:能直接将它们的网络连接到一起,使它们之间的所有流量直接连接而不是通过上游的中间ISP传输
  - 当两个ISP对等的时候,通常不进行结算(不用付费)
  - 第三方公司创建一个**因特网交换点(IXP)**, IXP是一个汇合点,多个ISP能够在这里对等

#### **网络结构Ⅳ:**  
由接入ISP, 区域ISP, 第一层ISP, PoP, 多宿, 对等和IXP组成的生态系统, 这个系统作为网络结构Ⅳ

#### **网络结构Ⅴ:**  
通过在网络结构Ⅳ顶部增加**内容提供商网络**构建而成

## 分组交换网中的时延,丢包和吞吐量

### 分组交换网中的时延概述

分组在每个结点都经受了机重不同类型的时延:

- 结点处理时延
- 排队时延
- 传输时延(与宽带,数据大小有关,数据为L/R),路由器将分组推出所用的时间
- 传播时延(速率取决于物理媒体),两台路由器之间距离的函数

以上时延总体累加起来是**结点总时延**

### 排队时延和丢包

令a为分组到达队列的平均速率(单位为分组/秒, pkt/s),R为传输速率, 则比特到达队列的平均速率为 La bps,  若该队列能容纳无限数量的比特, 则流量强度为 $$La/R$$. 

设计系统时流量强度不能大于 1

随着流量强度接近1,排队时延并不实际趋向无穷大. 相反,到达的分组发现一个满的队列.  
由于没有地方存储这个分组,路由器将**丢弃**该分组,即该分组会**丢失**. 

## 协议层次及其服务模型

### 分层的体系结构

各层的所有协议被称为**协议栈**, 因特网的协议栈由5个层次组成: 物理层, 链路层, 网络层, 运输层和应用层. 

| (五层因特网协议栈) |
| :----------------: |
|       应用层       |
|       运输层       |
|       网络层       |
|       链路层       |
|       物理层       |

| (七层ISO OSI参考模型) |
| :-------------------: |
|        应用层         |
|        表示层         |
|        会话层         |
|        运输层         |
|        网络层         |
|        链路层         |
|        物理层         |

- 应用层
  - 网络应用程序和它们的应用层协议存留的地方, 如HTTP SMTP FTP
  - 应用层协议分布在多个端系统上,一个端系统中的应用程序使用协议与另一个端系统上的应用程序交换信息的分组. ==将这种位于应用层的信息分组称为**报文(message)**==
- 运输层
  - 因特网的运输层在应用程序端点之间传送应用层报文
  - 在因特网中,两个运输协议 TCP和UDP, TCP向它的应用程序提供了面向连接服务, UDP协议提供了无连接服务  
  - ==将运输层分组称为**报文段(segment)**==
- 网络层
  - ==将网络层分组称为**数据报(datagram)**==
  - 因特网的网络层负责将称为**数据报**的网络层分组从一台主机移动到另一台主机
  - 运输层协议向网络层提交运输层报文段和目的地址
  - 网络层包括著名的IP协议,定义了数据报中各个字段以及端系统和路由器如何作用于这些字段
  - 因特网的网络层也包括决定路由的**路由选择协议**,使得数据报根据该路由从源传输到目的地
- 链路层
  - 网络层将数据下传给链路层,链路层沿着路径将数据报传给下一个结点,在下个结点,链路层将数据上传给网路层
  - ==将链路层分组称为**帧(frame)**==
- 物理层
  - 将帧中的一个一个比特从一个结点移动到下一个结点

### 封装

![流程](https://wx1.sbimg.cn/2020/07/23/Dn3yn.md.png)

1. 在发送主机端,一个应用层报文(图中M)被传送给运输层.   
2. 运输层收到报文并附上附加信息(运输层首部信息, $$H_t$$),该首部被接收端的运输层使用
3. 网络层增加如源和目的端系统地址等网络信息(图中的$$H_n$$),产生网络层数据报
4. 链路层增加他自己的链路层首部信息并创建链路层帧

![](https://wx1.sbimg.cn/2020/08/02/Pb4CA.md.jpg)

网络核心设备并不在应用层上起作用