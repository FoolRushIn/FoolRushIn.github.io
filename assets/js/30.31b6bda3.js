(window.webpackJsonp=window.webpackJsonp||[]).push([[30],{516:function(P,v,_){"use strict";_.r(v);var o=_(4),t=Object(o.a)({},(function(){var P=this,v=P.$createElement,_=P._self._c||v;return _("ContentSlotsDistributor",{attrs:{"slot-key":P.$parent.slotKey}},[_("h1",{attrs:{id:"web页面请求的历程"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#web页面请求的历程"}},[P._v("#")]),P._v(" Web页面请求的历程")]),P._v(" "),_("p",[P._v("学生bob将它的便携机与学校的以太网交换机相连, 下载一个web页面")]),P._v(" "),_("p",[_("img",{attrs:{src:"https://wx1.sbimg.cn/2020/08/22/3SqkT.md.png",alt:""}})]),P._v(" "),_("h2",{attrs:{id:"准备-dhcp-udp-ip和以太网"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#准备-dhcp-udp-ip和以太网"}},[P._v("#")]),P._v(" 准备: DHCP UDP IP和以太网")]),P._v(" "),_("p",[P._v("用一根以太网电缆将便携机连接到学校的以太网交换机. 交换机又和学校的路由器相连. 学校的路由器与一个ISP连接. 若ISP为comcast.net. ISP为学校提供了DNS服务. 所以, DNS服务器驻留在comcast网络中而不是学校网络中. 假设DHCP服务器运行在路由器中")]),P._v(" "),_("p",[P._v("便携机与网络相连的时候需要一个IP地址, 即是运行DHCP协议,以从本地DHCP服务器获得一个IP地址以及其他信息")]),P._v(" "),_("ol",[_("li",[P._v("便携机的操作系统生成一个"),_("strong",[P._v("DHCP请求报文")]),P._v(", 并将这个报文放入具有目的地端口67(DHCP服务器)和源端口68(DHCP客户)的"),_("strong",[P._v("UDP报文段")]),P._v(". 该报文段被放置在一个具有广播IP目的地地址和源IP地址0.0.0.0的"),_("strong",[P._v("IP数据报")]),P._v("中.")]),P._v(" "),_("li",[P._v("包含DHCP请求报文的IP数据报被放置在以太网帧中. 该以太网帧具有目的MAC地址 FF:FF:FF:FF:FF:FF , 使该帧将广播到与交换机连接的所有设备(如果顺利也包含DHCP服务器); 该帧的源MAC地址是便携机的MAC地址 00:16:D3:23:68:8A")]),P._v(" "),_("li",[P._v("包含DHCP请求的广播以太网帧是第一个由便携机发送到以太网交换机的帧. 该交换机在所有的出端口广播入帧, 包括连接到路由器的端口")]),P._v(" "),_("li",[P._v("路由器在它的具有MAC 00:22:6B:45:1F 的接口接收到该广播以太网帧,该帧包含DHCP请求, 并且从该以太网帧中抽取出IP数据报. 该数据报的广播IP目的地址指示了这个IP数据报应当在该结点的高层协议处理, 因此该数据报的载荷(一个UDP报文段)被分解向上到达UDP, DHCP请求报文从此UDP报文段中抽取出来. 此时DHCP服务器有了DHCP请求报文")]),P._v(" "),_("li",[P._v("假设运行在路由器中的DHCP服务器能够以CIDR块 68.85.2.0/24 分配IP地址. 若DHCP服务器分配地址 68.85.2.101 给便携机. DHCP服务器生成包含这个IP地址以及DNS服务器的IP地址(68.87.71.226), 默认网关路由器的IP地址(68.85.2.1)和子网块(68.85.2.0/24)(等价为'网络掩码')的一个DHCP ACK报文. 该DHCP报文被放入一个UDP报文段中, UDP报文段被放入一个IP数据报中, IP数据报再被放入一个以太网帧中. 这个以太网帧的源MAC地址是路由器连接到归属网络时接口的MAC地址(00:22:6B:45:1F:1B), 目的MAC地址是便携机的MAC地址(00:16:D3:23:68:8A)")]),P._v(" "),_("li",[P._v("包含DHCP ACK的以太网帧由路由器发送给交换机. 因为交换机是自学习的, 并且先前从便携机收到(包含DHCP请求的)以太网帧, 所以该交换机知道寻址到 00:16:D3:23:68:8A 的帧仅从通向便携机的输出端口转发")]),P._v(" "),_("li",[P._v("便携机接收到包含DHCP ACK的以太网帧, 从该以太网帧中抽取IP数据报,从IP数据报中抽取UDP报文段, 从UDP报文段抽取DHCP ACK报文. DHCP客户则记录下IP地址和DNS服务器的IP地址. 还在其IP转发表中安装默认网关的地址. 便携机将向该默认网关发送目的地址为其子网 68.85.2.0/24 以外的所欲数据报.")])]),P._v(" "),_("h2",{attrs:{id:"仍在准备-dns和arp"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#仍在准备-dns和arp"}},[P._v("#")]),P._v(" 仍在准备: DNS和ARP")]),P._v(" "),_("p",[P._v("当在浏览器把www.goole.com的URL输入到Web浏览器中时,开启了一串事件,这将导致谷歌主页最终显示在Web浏览器上.Web浏览器通过生成一个"),_("strong",[P._v("TCP套接字")]),P._v("开始该过程,套接字用于向www.google.com发送"),_("strong",[P._v("HTTP请求")]),P._v(".为了生成该套接字,需要知道www.google.com的IP地址.需要使用"),_("strong",[P._v("DNS协议")]),P._v("提供这种名字到IP地址的转换服务.")]),P._v(" "),_("ol",[_("li",[P._v("便携机操作系统因此生成一个"),_("strong",[P._v("DNS查询报文")]),P._v(",将字符串www.google.com放入DNS报文的问题段中.该DNS报文则放置在一个具有53号(DNS服务器)目的端口的UDP报文段中.该UDP报文段则被放入具有IP目的地址68.87.71.226(DHCP ACK返回的DNS服务器地址)和源IP地址68.85.2.101的IP数据报中.")]),P._v(" "),_("li",[P._v("便携机则将包含DNS请求报文的数据报IP放入到一个以太网帧中.该帧将发送(在链路层寻址)到学校网络中的网关路由器.然而,即使便携机虽然获取了网关路由器的IP地址(68.85.2.1),但仍不知道该网关路由器的MAC地址.为了获得该网关路由器的MAC地址,需要使用ARP(地址解析协议)协议.")]),P._v(" "),_("li",[P._v("便携机生成一个具有目的IP地址68.85.2.1(默认网关)的"),_("strong",[P._v("ARP查询报文")]),P._v(",将该ARP报文放置在一个具有广播目的地址(FF:FF:FF:FF:FF:FF:FF)的以太网帧中,并向交换机发送该以太网帧,交换机将该帧交付给所有连接的设备,包括网关路由器.")]),P._v(" "),_("li",[P._v("网关路由器在接口上收到包含该ARP查询报文的帧,发现ARP报文中目的地址IP地址68.85.2.1匹配接口的IP地址.网关路由器因此准备一个"),_("strong",[P._v("ARP回答")]),P._v(",指示它的MAC地址00:22:6B:45:1F:1B对应地址68.85.2.1,它将ARP回答放在一个以太网帧中,其目的地址为00:16:D3:23:68:8A,并向交换机发送该帧,再由交换机将该帧交付给便携机.")]),P._v(" "),_("li",[P._v("便携机接收包含ARP回答报文的帧,并从ARP回答报文中抽取网关路由器的MAC地址(00:22:6B:45:1F:1B)")]),P._v(" "),_("li",[P._v("便携机能够包含DNS查询的以太网帧寻址到网关路由器的MAC地址.注意,该帧中的IP数据报具有IP目的地址68.87.71.226(DNS服务器),而该帧具有目的地址00:22:6B:45:1F:1B(网关路由器).便携机像交换机发送包含DNS报文的帧,交换机将该帧交付给网关路由器.")])]),P._v(" "),_("h2",{attrs:{id:"仍在准备-域内路由选择到dns服务器"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#仍在准备-域内路由选择到dns服务器"}},[P._v("#")]),P._v(" 仍在准备：域内路由选择到DNS服务器")]),P._v(" "),_("ol",[_("li",[P._v("网关路由器接收该帧并抽取包含DNS查询的IP数据报。路由器查找该数据报的目的地址（68.87.71.226），并根据其转发表决定该数据报应当发送到Comcast网络最左侧的路由器。")]),P._v(" "),_("li",[P._v("在Comcast网络中最左侧的路由器接收到该帧，抽取IP数据报，检查该数据报的目的地址（68.87.71.226），并根据其转发表确定出接口，经过该接口朝着DNS服务器转发数据报，而转发表已经根据域内协议以及因特网的"),_("strong",[P._v("域间协议BGP")]),P._v("所填写。")]),P._v(" "),_("li",[P._v("最终包含DNS查询的IP数据报到达了DNS服务器。DNS服务器抽取出DNS查询报文，在它的DNS数据库中查找名字www.google.com，找到包含对应www.google.com的IP地址（64.233.169.105）的"),_("strong",[P._v("DNS源记录")]),P._v("。（假设是当前缓存在DNS服务器中）。这种缓存数据源于google.com权威"),_("strong",[P._v("DNS服务器")]),P._v("。该DNS服务器形成了一个包含这种主机名到IP地址映射的"),_("strong",[P._v("DNS回答报文")]),P._v("，将该DNS回答报文放入UDP报文段中，该报文段放入寻址（68.85.2.101）的IP数据报中。该数据报将通过路由器反向转发到学校的路由器，并从这里进过以太网交换机到便携机的主机。")]),P._v(" "),_("li",[P._v("便携机主机从DNS报文中取出服务器www.google.com的IP地址。")])]),P._v(" "),_("h2",{attrs:{id:"web客户-服务器交互-tcp和http"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#web客户-服务器交互-tcp和http"}},[P._v("#")]),P._v(" Web客户-服务器交互：TCP和HTTP")]),P._v(" "),_("ol",[_("li",[P._v("既然便携机有了www.google.com的IP地址，它能够生成"),_("strong",[P._v("TCP套接字")]),P._v("，该套接字将用于向www.google.com发送"),_("strong",[P._v("HTTP GET报文")]),P._v("。当生成TCP套接字时，便携机的TCP必须首先与www.google.com中的TCP执行"),_("strong",[P._v("三次握手")]),P._v("。便携机因此首先生成一个具有目的端口80（针对HTTP的）的TCP SYN报文段，将该TCP报文段放置在具有目的IP地址(64.233.169.105 www.google.com)的IP数据报中，将该数据报放置在MAC地址为00:22:6B:45:1F:1B（网关路由器）的帧中，并向交换机发送该帧。")]),P._v(" "),_("li",[P._v("在学校网络，Comcast网络和谷歌网络中的路由器朝着www.google.com转发包含TCP SYN的数据报，使用每台路由器中的转发表。支配分组经comcast和 谷歌网络之间域间链路转发的路由器转发表项，是由"),_("strong",[P._v("BGP(自治系统间路由选择)协议")]),P._v("决定的。")]),P._v(" "),_("li",[P._v("最终，包含TCP SYN的数据报到达www.google.com。从数据报抽取出TCP SYN报文并分解到与端口80相联系的欢迎套接字。然后产生一个TCP SYNACK报文段，将其放入想便携机寻址的一个数据报中，最后放入链路层帧中，该链路适合将www.google.com链接到第一跳路由。")]),P._v(" "),_("li",[P._v("包含TCP SYNACK报文段的数据报通过谷歌，comcast和学校网络，最终达到便携机的以太网卡。数据报在操作系统中分解到TCP套接字，从而进入链接状态。")]),P._v(" "),_("li",[P._v("现在准备向www.google.com发送字节了，浏览器生成包含获取的URL的HTTP GET报文。HTTP GET报文则写入套接字，其中GET报文成为一个TCP报文段的载荷。该TCP报文段放入一个IP数据报中，并交付到www.google.com。")]),P._v(" "),_("li",[P._v("在www.google.com的HTTP服务器从TCP套接字中读取HTTP GET报文，生成一个HTTP响应报文，将请求的Web网页放入到HTTP响应体中，并报文发送进TCP套接字中。")]),P._v(" "),_("li",[P._v("包含HTTP回答报文的数据报通过谷歌，comcast和学校网络进行转发，到达便携机。浏览器从套接字中读取HTTP响应，从HTTP响应体中抽取Web网页的html，并最终显示了web网页。")])])])}),[],!1,null,null,null);v.default=t.exports}}]);